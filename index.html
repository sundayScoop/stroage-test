<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Storage Access API Tester – Parent</title>
</head>
<body>
  <h1>Parent (GitHub Pages)</h1>
  <p>Embedding <strong>http://localhost:8080/child.html</strong> as a third‑party iframe.</p>

  <iframe
  src="http://localhost:8080/child.html"
  sandbox="allow-scripts allow-same-origin allow-storage-access-by-user-activation"
  width="600" height="400">
</iframe>

  <script>
    window.open("http://localhost:8080/child.html");
    const CHILD_ORIGIN = 'http://localhost:8080';
    const frame = document.getElementById('childFrame');

    window.addEventListener('message', e => {
      if (e.origin !== CHILD_ORIGIN) return;

      // 1) Relay popup‑done back into the iframe
      if (e.data === 'saa-popup-done') {
        frame.contentWindow.postMessage('saa-popup-done', CHILD_ORIGIN);
        return;
      }

      // 2) Handle the child's “openPopup” request
      if (e.data && e.data.action === 'openPopup') {
        window.open(
          `${CHILD_ORIGIN}/child.html?popup=1`,
          'saa-popup',
          'width=500,height=500'
        );
      }
      // 3) Handle the child's “redirect” request
      else if (e.data && e.data.action === 'redirect' && e.data.url) {
        window.location.href = e.data.url;
      }
    });
  </script>
</body>
</html>
